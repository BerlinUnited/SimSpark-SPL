; -*- mode: lisp; -*-

(RSG 0 1)
(
    ;
    ;Template
    ;@param LRFactor is (left_leg ? -1 : 1)
    ;    
    (templ  $LRFactor 
            $Torso_X $Torso_Y $Torso_Z
            $Joint1_2PerName $Joint1_2EffName
            $Joint3PerName $Joint3EffName
            $Joint4PerName $Joint4EffName
            $Joint5PerName $Joint5EffName
            $Joint6PerName $Joint6EffName
    )
    
    
    ;
    ;Position Parameters
    ;
    (def $HipRelTorso_X (eval $LRFactor * 0.055))
    (def $HipRelTorso_Y -0.01)
    (def $HipRelTorso_Z -0.115)
    
    (def $ThighRelHip_X 0)
    (def $ThighRelHip_Y 0.01)
    (def $ThighRelHip_Z -0.04)
    
    (def $ShankRelThigh_X 0)
    (def $ShankRelThigh_Y 0.005)
    (def $ShankRelThigh_Z -0.125)
    
    (def $AnkleRelShank_X 0)
    (def $AnkleRelShank_Y -0.01)
    (def $AnkleRelShank_Z -0.055)
    
    (def $FootRelAnkle_X 0)
    (def $FootRelAnkle_Y 0.03)
    (def $FootRelAnkle_Z -0.035)
    
    (def $Hip_X (eval $Torso_X + $HipRelTorso_X))
    (def $Hip_Y (eval $Torso_Y + $HipRelTorso_Y))
    (def $Hip_Z (eval $Torso_Z + $HipRelTorso_Z))
    
    (def $Thigh_X (eval $Hip_X + $ThighRelHip_X))
    (def $Thigh_Y (eval $Hip_Y + $ThighRelHip_Y))
    (def $Thigh_Z (eval $Hip_Z + $ThighRelHip_Z))
    
    (def $Shank_X (eval $Thigh_X + $ShankRelThigh_X))
    (def $Shank_Y (eval $Thigh_Y + $ShankRelThigh_Y))
    (def $Shank_Z (eval $Thigh_Z + $ShankRelThigh_Z))
    
    (def $Ankle_X (eval $Shank_X + $AnkleRelShank_X))
    (def $Ankle_Y (eval $Shank_Y + $AnkleRelShank_Y))
    (def $Ankle_Z (eval $Shank_Z + $AnkleRelShank_Z))
    
    (def $Foot_X (eval $Ankle_X + $FootRelAnkle_X))
    (def $Foot_Y (eval $Ankle_Y + $FootRelAnkle_Y))
    (def $Foot_Z (eval $Ankle_Z + $FootRelAnkle_Z))
    
    ;
    ;Size and Mass Parameters
    ;
    (def $HipRadius 0.01)
    (def $HipMass   0.215)
    
    (def $ThighSizeX 0.07)
    (def $ThighSizeY 0.07)
    (def $ThighSizeZ 0.14)
    (def $ThighMass  0.275)
    
    (def $ShankSizeX 0.08)
    (def $ShankSizeY 0.07)
    (def $ShankSizeZ 0.11)
    (def $ShankMass  0.225)
    
    (def $AnkleRadius 0.01)
    (def $AnkleMass   0.125)
    
    (def $FootSizeX   0.08)
    (def $FootSizeY   0.16)
    (def $FootSizeZ   0.03)
    (def $FootMass    0.2)
    
    
    ;
    ;Joint Parameters
    ;
    (def $lj1_2_min0    -1.5708)
    (def $lj1_2_max0    0.1745)
    
    (def $lj1_2_min1    -0.4363)
    (def $lj1_2_max1    1.5708)
    
    (def $right_lj3_min -0.7845)
    (def $left_lj3_min  -0.3491)
    (def $lj3_min_c1    (eval (eval $right_lj3_min + $left_lj3_min) * 0.5))
    (def $lj3_min_c2    (eval (eval $right_lj3_min - $left_lj3_min) * 0.5))
    (def $lj3_min       (eval $lj3_min_c1 + (eval $LRFactor * $lj3_min_c2)))
    
    (def $right_lj3_max 0.3491)
    (def $left_lj3_max  0.7845)
    (def $lj3_max_c1    (eval (eval $right_lj3_max + $left_lj3_max) * 0.5))
    (def $lj3_max_c2    (eval (eval $right_lj3_max - $left_lj3_max) * 0.5))
    (def $lj3_max       (eval $lj3_max_c1 + (eval $LRFactor * $lj3_max_c2)))
    
    (def $lj4_min       -2.2689)
    (def $lj4_max       0)
    
    (def $lj5_min       -0.5236)
    (def $lj5_max       1.3963)
    
    (def $right_lj6_min -0.3491)
    (def $left_lj6_min  -0.7854)
    (def $lj6_min_c1    (eval (eval $right_lj6_min + $left_lj6_min) * 0.5))
    (def $lj6_min_c2    (eval (eval $right_lj6_min - $left_lj6_min) * 0.5))
    (def $lj6_min       (eval $lj6_min_c1 + (eval $LRFactor * $lj6_min_c2)))
    
    (def $right_lj6_max  0.7854)
    (def $left_lj6_max   0.3491)
    (def $lj6_max_c1    (eval (eval $right_lj6_max + $left_lj6_max) * 0.5))
    (def $lj6_max_c2    (eval (eval $right_lj6_max - $left_lj6_max) * 0.5))
    (def $lj6_max       (eval $lj6_max_c1 + (eval $LRFactor * $lj6_max_c2)))
    
    ;(def $lj1_2_axis0_x   -0.7071)
    ;(def $lj1_2_axis0_y   (eval $LRFactor * 0.7071))
    ;(def $lj1_2_axis0_z   0)

    (def $lj3_Anchor_X  (eval -1 * $ThighRelHip_X))
    (def $lj3_Anchor_Y  (eval -1 * $ThighRelHip_Y))
    (def $lj3_Anchor_Z  (eval -1 * $ThighRelHip_Z))
    
    ;
    ;Construct Hip
    ;
    (nd Transform
        (setName hip)
        (setLocalPos $Hip_X $Hip_Y $Hip_Z)

        (importScene rsg/agent/nao/sphere_appearance.rsg $HipRadius matYellow)
        (importScene rsg/agent/nao/sphere_physics.rsg    $HipRadius $HipMass)
        
        (importScene rsg/agent/nao/universaljoint.rsg
                              $Joint1_2PerName $Joint1_2EffName
                              ../../body/boxBody ../sphereBody 
                              0 0 0  ;anchor
                              0 0 1  ;axis1
                              1 0 0  ;axis2
                              $lj1_2_min0 $lj1_2_max0 
                              $lj1_2_min1 $lj1_2_max1)
    )
    
     
    ;
    ;Construct Thigh
    ;
    (nd Transform
       (setName thigh)
       (setLocalPos $Thigh_X $Thigh_Y $Thigh_Z)
       ;(setLocalRotation 8.594 0 0)
        
       (importScene rsg/agent/nao/box_appearance.rsg $ThighSizeX $ThighSizeY $ThighSizeZ matBlue)
       (importScene rsg/agent/nao/box_physics.rsg    $ThighSizeX $ThighSizeY $ThighSizeZ $ThighMass)
        
       (importScene rsg/agent/nao/hingejoint.rsg
                               $Joint3PerName $Joint3EffName
                               ../boxBody ../../hip/sphereBody
                               $lj3_Anchor_X $lj3_Anchor_Y $lj3_Anchor_Z
                               0 1 0 ;1 -1 -1
                               $lj3_min $lj3_max)
        
    )
    
    ;
    ;Construct Shank
    ;
    (nd Transform
        (setName shank)
        (setLocalPos $Shank_X $Shank_Y $Shank_Z)
        ;(setLocalRotation -8.594 0 0)
        
        (importScene rsg/agent/nao/box_appearance.rsg $ShankSizeX $ShankSizeY $ShankSizeZ matGrey)
        (importScene rsg/agent/nao/box_physics.rsg    $ShankSizeX $ShankSizeY $ShankSizeZ $ShankMass)
        
        (importScene rsg/agent/nao/hingejoint.rsg
                                $Joint4PerName $Joint4EffName
                                ../boxBody ../../thigh/boxBody
                                0 -0.01 -0.045
                                1 0 0 ;0 -1 -1
                                $lj4_min $lj4_max)
        
    )
    
    ;
    ;Construct Ankle 
    ;
    (nd Transform
        (setName ankle)
        (setLocalPos $Ankle_X $Ankle_Y $Ankle_Z)
        
        (importScene rsg/agent/nao/sphere_appearance.rsg $AnkleRadius matRed)
        (importScene rsg/agent/nao/sphere_physics.rsg    $AnkleRadius $AnkleMass)
        
        (importScene rsg/agent/nao/hingejoint.rsg
                              $Joint5PerName $Joint5EffName
                              ../sphereBody ../../shank/boxBody
                              0 0 0
                              1 0 0 ;0 -1 -1
                              $lj5_min $lj5_max)
        
     )    
     
    ;
    ;Construct Foot
    ;
    (nd Transform
        (setName foot)
        (setLocalPos $Foot_X $Foot_Y $Foot_Z)
        
        (importScene rsg/agent/nao/box_appearance.rsg $FootSizeX $FootSizeY $FootSizeZ matBlue)
        (importScene rsg/agent/nao/box_physics.rsg    $FootSizeX $FootSizeY $FootSizeZ $FootMass)
        
        (importScene rsg/agent/nao/hingejoint.rsg
                                $Joint6PerName $Joint6EffName
                                ../boxBody ../../ankle/sphereBody
                                0 -0.03 0.035
                                0 1 0 ;1 -1 -1
                                $lj6_min $lj6_max)
        
    )
)
