; -*- mode: lisp; -*-

(RubySceneGraph 0 1)
(
;
; define constants
;
 (define $FieldLength 100)
 (define $FieldWidth  70)
 (define $FieldBaseHeight 4)
 (define $BorderExt 5)
 (define $SideExt 2)
 (define $SideHeight 1)
 (define $LineExt 0.2)

 (define $FieldMaterial matGreen)
 (define $BorderMaterial matYellow)
 (define $SideMaterial matGrey)
 (define $LineMaterial matWhite)
 
 (define $FieldHalfLength (eval $FieldLength / 2.0))
 (define $FieldHalfWidth  (eval $FieldWidth / 2.0))

 (define $HalfBorderExt   (eval $BorderExt / 2.0))
 (define $BorderLength    (eval $FieldHalfLength + $HalfBorderExt))
 (define $BorderWidth     (eval $FieldHalfWidth + $HalfBorderExt))

 (define $SideLength      (eval $FieldHalfLength + $BorderExt))
 (define $SideWidth       (eval $FieldHalfWidth  + $BorderExt))

 (define $LineWidth       (eval $FieldWidth - $LineExt))

;
; construct playing field
;

; add lights
 (node Transform
       (setLocalPos -10 10 10)
       (node Light
	     (setDiffuse 1.0 1.0 1.0 1.0)
	     (setSpecular 0.1 0.1 0.1 1.0)
	     (setAmbient 0.8 0.8 0.8 1.0)
	     )

       )

; add lights
 (node Transform
       (setLocalPos 10 -10 10)
       (node Light
	     (setDiffuse 1.0 1.0 1.0 1.0)
	     (setSpecular 0.1 0.1 0.1 1.0)
	     (setAmbient 0.0 0.0 0.0 1.0)
	     )
       )

; create the base plane
 (node Transform
       (setLocalPos 0 0 -3)
       (node Box
	     (setMaterial $FieldMaterial)
	     (setExtents $FieldLength $FieldWidth $FieldBaseHeight)
	     )
       (node PlaneCollider
	     (setParams 0 0 1.0 -1)
	     (node ContactJointHandler
		   (setContactBounceMode false)
		   )
	     )
       )


; create left side
 (node Transform
       (setLocalPos (eval -1 * $SideLength) 0 0)
       (node Box
	     (setMaterial $SideMaterial)
	     (setExtents $SideHeight (eval $FieldWidth + 2 * $BorderExt) $SideExt)
	     ) 
       (node PlaneCollider
	     (setParams 1.0 0 0 (eval -1 * $SideLength))
	     )
       )


; create right side
 (node Transform
       (setLocalPos $SideLength 0 0)
       (node Box
	     (setMaterial $SideMaterial)
	     (setExtents $SideHeight (eval $FieldWidth + 2 * $BorderExt) $SideExt)
	     ) 
       (node PlaneCollider
	     (setParams -1.0 0 0 (eval -1 * $SideLength))
	     )
       )


; create back side
 (node Transform
       (setLocalPos 0 $SideWidth 0)
       (node Box
	     (setMaterial $SideMaterial)
	     (setExtents (eval $FieldLength + 2 * $BorderExt) $SideHeight $SideExt)
	     ) 
       (node PlaneCollider
	     (setParams 0 -1.0 0 (eval -1 * $SideWidth))
	     )
       )

; create front side
 (node Transform
       (setLocalPos 0 (eval -1 * $SideWidth) 0)
       (node Box
	     (setMaterial $SideMaterial)
	     (setExtents (eval $FieldLength + 2 * $BorderExt) 1 2)
	     ) 
       (node PlaneCollider
	     (setParams 0 1.0 0 (eval -1 * $SideWidth))
	     )
       )

; create middle line
 (node Transform
       (setLocalPos 0 0 -1)
       (node Box
	     (setExtents $LineExt $LineWidth $LineExt)
	     (setMaterial $LineMaterial)
	     )
       )

; create front line
 (node Transform
       (setLocalPos 0 (eval -1 * $FieldHalfWidth) -1)
       (node Box
	     (setExtents $FieldLength $LineExt $LineExt)
	     (setMaterial $LineMaterial)
	     )
       )

; create back line
 (node Transform
       (setLocalPos 0 $FieldHalfWidth -1)
       (node Box
	     (setExtents $FieldLength $LineExt $LineExt)
	     (setMaterial $LineMaterial)
	     )
       )

; create left line
 (node Transform
       (setLocalPos (eval -1 * $FieldHalfLength) 0 -1)
       (node Box
	     (setExtents $LineExt $LineWidth $LineExt)
	     (setMaterial $LineMaterial)
	     )
       )

; create right line
 (node Transform
       (setLocalPos $FieldHalfLength 0 -1)
       (node Box
	     (setExtents $LineExt $LineWidth $LineExt)
	     (setMaterial $LineMaterial)
	     )
       )

; create left outer field
 (node Transform
       (setLocalPos (eval -1 * $BorderLength) 0 -3)
       (node Box
	     (setMaterial $BorderMaterial)
	     (setExtents $BorderExt $FieldWidth 4)
	     )
       )

; create right outer field
 (node Transform
       (setLocalPos $BorderLength 0 -3)
       (node Box
	     (setMaterial $BorderMaterial)
	     (setExtents $BorderExt $FieldWidth 4)
	     )
       )

; create front outer field
 (node Transform
       (setLocalPos 0 (eval -1 * $BorderWidth) -3)
       (node Box
	     (setMaterial $BorderMaterial)
	     (setExtents (eval $FieldLength + 2 * $BorderExt) 5 4)
	     )
       )

; create back outer field
 (node Transform
       (setLocalPos 0 $BorderWidth -3)
       (node Box
	     (setMaterial $BorderMaterial)
	     (setExtents (eval $FieldLength + 2 * $BorderExt) 5 4)
	     )
       )

;;
;; add flags
;;

 (importScene rsg/agent/flag.rsg 
	      (eval -1 * $FieldHalfLength)  
	      $FieldHalfWidth
	      0 
	      Flag_1_l matRed
	      )

 (importScene rsg/agent/flag.rsg 
	      (eval -1 * $FieldHalfLength) 
	      (eval -1 * $FieldHalfWidth)
	      0
	      Flag_2_l matRed
	      )

 (importScene rsg/agent/flag.rsg 
	      $FieldHalfLength 
	      $FieldHalfWidth 
	      0 
	      Flag_1_r matBlue
	      )

 (importScene rsg/agent/flag.rsg 
	      $FieldHalfLength 
	      (eval -1 * $FieldHalfWidth) 
	      0 
	      Flag_2_r 
	      matBlue
	      )

;;
;; add the ball
;;
 (importScene rsg/agent/ball.rsg)

 )